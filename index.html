<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Williamnagar Polytechnic Cash Book</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <style>
        /* --- PRINTING RULES --- */
        @media print {
            /* 1. Hide UI Elements */
            button, input, select, .admin-panel, #login-view, #loading-overlay, .no-print {
                display: none !important; 
            }
        
            /* 2. The "Nuclear Option" for Scrollbars */
            /* The asterisk targets literally EVERY element on the page */
            * {
                overflow: visible !important;
            }
        
            /* 3. Force Table to Fit the Physical Page */
            table {
                width: 100% !important;
                max-width: 100% !important;
                table-layout: fixed !important; /* Forces columns to obey the page width */
                border-collapse: collapse !important;
            }
        
            /* 4. Shrink Text and Wrap Words to Save Space */
            th, td {
                border: 1px solid #000 !important;
                color: #000 !important; /* Black ink only */
                font-size: 10px !important; /* Shrink text to fit more bank columns */
                word-wrap: break-word !important; /* Force long text to wrap to a new line */
                white-space: normal !important;
                padding: 4px !important; /* Reduce padding to save space */
            }
        
            /* 5. Ensure Headers Repeat on New Pages */
            thead { display: table-header-group !important; }
            tr { page-break-inside: avoid !important; }
        
            /* 6. Page Setup */
            @page {
                size: A4 landscape;
                margin: 10mm; /* Slightly smaller margins to give the table more room */
            }
        }
    </style>
</head>
<body>
    
    <div id="loading-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.7); z-index: 9999; justify-content: center; align-items: center; flex-direction: column; backdrop-filter: blur(2px);">
        <div style="border: 6px solid #f3f3f3; border-top: 6px solid #2980b9; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite;"></div>
        <h3 style="color: #2c3e50; margin-top: 15px; font-family: sans-serif;">Processing...</h3>
        <style>@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }</style>
    </div>
    
    <div id="login-view" class="login-container">
      <h2>WP Cash Book</h2>
      <input type="text" id="username" placeholder="Username">
      <input type="password" id="password" placeholder="Password">
      <button onclick="attemptLogin()" id="login-btn" style="width: 100%;">Secure Login</button>
      <div id="error-message" style="color:red; margin-top:10px; font-size:14px;"></div>
    </div>

    <div id="app-wrapper" class="app-container">
      
      <div class="nav-bar">
        <div class="nav-buttons">
          <button id="nav-dash" class="active" onclick="switchTab('dashboard')">Dashboard</button>
          <button id="nav-rep" onclick="switchTab('report')">Folio Report</button>
          <button id="nav-admin" onclick="switchTab('admin')" style="display:none; background-color:#8e44ad;">Admin Panel</button>
        </div>
        <div>
          <span id="welcome-text" style="font-weight: bold; margin-right: 15px; color:#2c3e50;"></span>
          <button class="btn-danger" onclick="location.reload()">Log Out</button>
        </div>
      </div>

      <div id="dashboard-view">
        <div class="summary-container" id="dynamic-summary-boxes"></div>

        <div class="card entry-form-row" id="form-container">
          <input type="date" id="entry-date" required>
          <input type="text" id="entry-details" placeholder="Particulars" required>
          <input type="text" id="entry-voucher" placeholder="Vch/Chq No.">
          
          <select id="entry-method" required>
            <option value="" disabled selected>Select Cash/Bank...</option>
          </select>
          
          <select id="entry-type">
                <option value="" disabled selected>Select Type...</option>
                <option value="Receipt">Receipt (+)</option>
                <option value="Payment">Payment (-)</option>
          </select>
          <input type="number" id="entry-amount" placeholder="Amount" step="0.01" required>
          
          <button onclick="submitNewEntry()" id="submit-btn" style="background-color:#2c3e50;">Post Entry</button>
          <button onclick="cancelEdit()" id="cancel-btn" style="display:none; background-color:#7f8c8d;">Cancel Edit</button>
        </div>

        <div class="card table-wrapper">
          <table>
            <thead>
              <tr id="table-header">
                <th>Date</th>
                <th>Particulars</th>
                <th>Vch/Chq</th>
                <th>Method</th>
                <th>Receipts (+)</th>
                <th>Payments (-)</th>
                <th>Cash Bal.</th>
                <th>Bank Bal.</th>
                <th>User</th>
                </tr>
            </thead>
            <tbody id="ledger-body"></tbody>
          </table>
        </div>
      </div>

      <div id="report-view" style="display: none;">
        <div class="card" style="display: flex; gap: 15px; align-items: center; background-color: #fdfdfd; flex-wrap: wrap;">
          <h3 style="margin: 0; color: #2c3e50; font-size:16px;">Generate Cash Book Page:</h3>
          <input type="month" id="report-month-picker" style="margin: 0; padding:8px;">
          <button onclick="generateReport()" id="generate-btn" style="background-color: #27ae60;">Calculate & Generate</button>
          
          <div style="margin-left: auto; display: flex; gap: 10px;">
              <button onclick="downloadPDF()" id="btn-pdf" style="background-color: #d35400;">Download PDF</button>
              <button onclick="window.print()" style="background-color: #7f8c8d;">Print</button>
          </div>
        </div>

        <div id="report-print-area" class="card table-wrapper" style="min-height: 400px; padding: 30px;">
          <h2 id="report-title" style="text-align: center; margin-top: 0;">Monthly Cash Book Report</h2>
          <div class="folio-container">
            <div class="folio-side left">
              <div class="folio-header">RECEIPTS (Dr.)</div>
              <table class="folio-table">
                <thead>
                  <tr>
                    <th class="col-date">Date</th>
                    <th class="col-part">Particulars</th>
                    <th class="col-vch">Vch/Chq</th>
                    <th class="col-cash">Cash</th>
                    <th class="col-bank">Bank</th>
                  </tr>
                </thead>
                <tbody id="report-receipts-body">
                  <tr><td colspan="5" style="text-align:center; padding: 20px;">Select a month and click Generate...</td></tr>
                </tbody>
              </table>
            </div>
            <div class="folio-side">
              <div class="folio-header">PAYMENTS (Cr.)</div>
              <table class="folio-table">
                <thead>
                  <tr>
                    <th class="col-date">Date</th>
                    <th class="col-part">Particulars</th>
                    <th class="col-vch">Vch/Chq</th>
                    <th class="col-cash">Cash</th>
                    <th class="col-bank">Bank</th>
                  </tr>
                </thead>
                <tbody id="report-payments-body">
                  <tr><td colspan="5" style="text-align:center; padding: 20px;">Select a month and click Generate...</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <div id="admin-view" style="display:none;">
        
        <div class="card">
          <h3 style="margin-top:0;">Manage Bank Accounts</h3>
          <p style="font-size: 12px; color: #666; margin-bottom: 10px;">Add banks here to enable them in the entry dropdown and dashboard boxes.</p>
          <div class="entry-form-row" style="margin-bottom: 15px;">
            <input type="text" id="new-bank-name" placeholder="Enter bank name (e.g. MCAB)">
            <button onclick="addNewBank()" id="btn-add-bank" style="background-color:#2980b9; flex: 0 1 150px;">Add Bank</button>
          </div>
          <table style="width: 100%; max-width: 500px; min-width: unset;">
            <thead><tr><th>Active Banks</th><th style="width: 80px;">Actions</th></tr></thead>
            <tbody id="banks-body"></tbody>
          </table>
        </div>

        <div class="card">
          <h3 style="margin-top:0;">Add New User</h3>
          <div class="entry-form-row">
            <input type="text" id="new-user" placeholder="Username">
            <input type="text" id="new-pass" placeholder="Password">
            <input type="text" id="new-name" placeholder="Full Name">
            <select id="new-role">
                <option value="cashier">Cashier</option>
                <option value="admin">Admin</option>
            </select>
            <button onclick="addNewUser()" id="btn-add-user" style="background-color:#27ae60;">Create User</button>
          </div>
        </div>
        
        <div class="card table-wrapper">
          <h3 style="margin-top:0;">Manage System Users</h3>
          <table style="min-width: 600px;">
            <thead>
                <tr><th>Username</th><th>Name</th><th>Status</th><th>Role</th><th>Actions</th></tr>
            </thead>
            <tbody id="users-body"></tbody>
          </table>
        </div>
      </div>

    </div>

    <script src="script.js?v=10"></script>
</body>
</html>
